// test: https://perf.link/#eyJpZCI6InNqMHd1aTNnanF3IiwidGl0bGUiOiJGaW5kaW5nIG51bWJlcnMgaW4gYW4gYXJyYXkgb2YgMTAwMCIsImJlZm9yZSI6ImNvbnN0IGRhdGEgPSBbLi4uQXJyYXkoMTAwMCkua2V5cygpXS5tYXAodiA9PiAoYXN5bmMgKCkgPT4gdikpXG4iLCJ0ZXN0cyI6W3sibmFtZSI6IlByb21pc2UgTWFwIiwiY29kZSI6ImxldCByZXMgPSBbXVxuXG5hd2FpdCBQcm9taXNlLmFsbChkYXRhLm1hcChhc3luYyB2ID0%2BIHJlcy5wdXNoKCBhd2FpdCB2KCkgKSkpXG5cbmNvbnNvbGUubG9nKHJlcykiLCJydW5zIjpbMTYyNSwxNzUwLDI1MDAsMjUwMCwxNjI1LDI2MjUsMjI1MCwyMDAwLDI3NTAsMjUwMCwyNzUwLDE4NzUsMjg3NSwyMjUwLDIzNzUsMjUwMCwyODc1LDE3NTAsMjUwMCwyMzc1LDIwMDAsMzM3NSwxODc1LDI2MjUsMTg3NSwyNjI1LDIyNTAsMjYyNSwyNTAwLDI1MDAsMjI1MCwyMDAwLDI1MDAsMjAwMCwyNTAwLDE4NzUsMjM3NSwxNzUwLDI1MDAsMjg3NSwyMTI1LDIyNTAsMzI1MCwxODc1LDMwMDAsMjUwMCwyMjUwLDI3NTAsMjUwMCwzMjUwLDIyNTAsMjI1MCwyNjI1LDE4NzUsMjAwMCwyMTI1LDI4NzUsMjEyNSwyNjI1LDE4NzUsMTc1MCwyNjI1LDIyNTAsMjEyNSwyNjI1LDE4NzUsMzAwMCwyMzc1LDIyNTAsMjI1MCwyMzc1LDIwMDAsMjg3NSwyMzc1LDIyNTAsMTg3NSwyNTAwLDI4NzUsMjUwMCwyMzc1LDIyNTAsMjM3NSwyNzUwLDMwMDAsMjAwMCwyMjUwLDI1MDAsMTg3NSwyMzc1LDI3NTAsMjAwMCwyMTI1LDI3NTAsMzAwMCwzMDAwLDIzNzUsMjI1MCwyMTI1LDI2MjUsMjc1MF0sIm9wcyI6MjM3N30seyJuYW1lIjoiUHJvbWlzZSBNYXAgYW5kIFNldCIsImNvZGUiOiJsZXQgcmVzID0gW11cblxuYXdhaXQgUHJvbWlzZS5hbGwoQXJyYXkuZnJvbShuZXcgU2V0KGRhdGEpKS5tYXAoYXN5bmMgdiA9PiByZXMucHVzaCggYXdhaXQgdigpICkpKVxuXG5jb25zb2xlLmxvZyhyZXMpIiwicnVucyI6WzE3NTAsMTg3NSwxNzUwLDIxMjUsMjI1MCwyMDAwLDIwMDAsMTYyNSwyMDAwLDE3NTAsMjM3NSwxNjI1LDE4NzUsMjg3NSwyNTAwLDIwMDAsMTc1MCwxNjI1LDIxMjUsMjI1MCwyMDAwLDIxMjUsMjI1MCwyMTI1LDEzNzUsMTg3NSwyMTI1LDIxMjUsMTYyNSwyMDAwLDIzNzUsMTYyNSwyMTI1LDIzNzUsMjEyNSwyNjI1LDIyNTAsMjI1MCwxODc1LDIwMDAsMjc1MCwyMjUwLDIyNTAsMjI1MCwyMDAwLDI4NzUsMjAwMCwxODc1LDE4NzUsMjI1MCwyMjUwLDIxMjUsMjAwMCwyNjI1LDI2MjUsMjM3NSwxODc1LDIxMjUsMjAwMCwyMTI1LDE2MjUsMjEyNSwyMjUwLDIwMDAsMjAwMCwyMDAwLDIxMjUsMTg3NSwxNzUwLDMwMDAsMjUwMCwyNjI1LDIwMDAsMjAwMCwyMjUwLDIzNzUsMjM3NSwyMjUwLDIyNTAsMjEyNSwyMzc1LDI3NTAsMjEyNSwyNTAwLDIxMjUsMjI1MCwyNjI1LDIxMjUsMjI1MCwyMjUwLDI2MjUsMTg3NSwxODc1LDI3NTAsMjI1MCwyMDAwLDE3NTAsMjYyNSwyNTAwLDIxMjVdLCJvcHMiOjIxNTF9LHsibmFtZSI6IlByb21pc2UgTWFwIGFuZCBTZXQiLCJjb2RlIjoibGV0IHJlcyA9IFtdXG5cbmF3YWl0IFByb21pc2UuYWxsKFsuLi5uZXcgU2V0KGRhdGEpXS5tYXAoYXN5bmMgdiA9PiByZXMucHVzaChhd2FpdCB2KCkgKSkpXG5cbmNvbnNvbGUubG9nKHJlcykiLCJydW5zIjpbMTYyNSwxODc1LDIwMDAsMTUwMCwxNjI1LDE3NTAsMjEyNSwyMDAwLDIwMDAsMjEyNSwxODc1LDIzNzUsMjI1MCwyMDAwLDE4NzUsMjM3NSwxODc1LDE2MjUsMjEyNSwyMDAwLDIwMDAsMTg3NSwyODc1LDIyNTAsMjYyNSwxODc1LDIyNTAsMjAwMCwyMjUwLDIzNzUsMTg3NSwyMTI1LDE4NzUsMjAwMCwxNjI1LDI2MjUsMjEyNSwyMzc1LDE3NTAsMjAwMCwyNzUwLDIwMDAsMjUwMCwyNTAwLDE4NzUsMjM3NSwyMTI1LDI3NTAsMjUwMCwxODc1LDI1MDAsMjI1MCwzMDAwLDIxMjUsMjYyNSwyMzc1LDIxMjUsMjI1MCwyMjUwLDIxMjUsMjM3NSwyNTAwLDIwMDAsMjM3NSwyMDAwLDIzNzUsMTg3NSwyMTI1LDE4NzUsMjM3NSwyNTAwLDI1MDAsMTg3NSwyMDAwLDIzNzUsMjAwMCwyMDAwLDE2MjUsMjEyNSwxODc1LDE4NzUsMjEyNSwxODc1LDE3NTAsMjEyNSwyNTAwLDE3NTAsMjg3NSwyMTI1LDE4NzUsMTg3NSwyMjUwLDIwMDAsMjM3NSwyMjUwLDIzNzUsMTg3NSwyMzc1LDIxMjUsMjM3NV0sIm9wcyI6MjE0MX0seyJuYW1lIjoibWFwIiwiY29kZSI6ImxldCByZXMgPSBbXVxuZGF0YS5tYXAodiA9PiByZXMucHVzaCh2KCkpKVxuXG5jb25zb2xlLmxvZyhhd2FpdCBQcm9taXNlLmFsbChyZXMpKSIsInJ1bnMiOlsyNTAwLDMzNzUsMzM3NSw0MjUwLDMwMDAsNDI1MCwzNzUwLDM1MDAsMzYyNSw0MDAwLDI2MjUsMzg3NSw0MDAwLDQyNTAsNDEyNSwyODc1LDQ1MDAsMzUwMCwzNjI1LDI3NTAsMzg3NSwzNTAwLDQ2MjUsMzEyNSwzNTAwLDM2MjUsMzM3NSwzNzUwLDUxMjUsNDUwMCwzODc1LDQyNTAsMzUwMCwzMjUwLDM2MjUsMzYyNSw0MDAwLDQzNzUsNDI1MCwzNTAwLDMzNzUsMzg3NSwzMDAwLDMwMDAsMjc1MCwzNTAwLDQ1MDAsNDAwMCw0Mzc1LDI3NTAsMzI1MCw0MTI1LDI2MjUsMzYyNSwzNTAwLDQwMDAsMzc1MCwzNzUwLDM4NzUsNDEyNSw0MDAwLDI4NzUsNDEyNSwzNTAwLDQyNTAsMzUwMCwzODc1LDI3NTAsMzUwMCwyODc1LDQ1MDAsMzAwMCwzMTI1LDQwMDAsMzM3NSwzNjI1LDM2MjUsMzg3NSwzODc1LDM2MjUsMzM3NSw0MDAwLDQxMjUsMzc1MCw0NTAwLDM3NTAsNDEyNSw0NjI1LDMyNTAsMzg3NSwzMjUwLDM2MjUsNDg3NSwzMjUwLDMyNTAsNDEyNSwzMjUwLDMxMjUsMzUwMCw0MDAwXSwib3BzIjozNjgyfSx7Im5hbWUiOiJmb3IiLCJjb2RlIjoibGV0IHJlcyA9IFtdXG5mb3IgKGNvbnN0IHYgb2YgZGF0YSApIFxuICByZXMucHVzaChhd2FpdCB2KCkpXG5cbmNvbnNvbGUubG9nKHJlcykiLCJydW5zIjpbMjEyNSwyMjUwLDMwMDAsMjYyNSwyODc1LDM1MDAsMzM3NSwzNjI1LDM3NTAsMzUwMCwyODc1LDI4NzUsMzAwMCwzMzc1LDI2MjUsMjc1MCwyNzUwLDMyNTAsMzUwMCwzMzc1LDI1MDAsMzEyNSwyMzc1LDI3NTAsMzEyNSwyODc1LDIyNTAsMzM3NSwzMzc1LDMwMDAsMzAwMCwzMDAwLDMwMDAsMjg3NSw0NzUwLDM1MDAsMzUwMCwzMTI1LDI2MjUsMzUwMCwzMTI1LDMxMjUsMjc1MCwzMjUwLDI3NTAsMzI1MCwyNzUwLDMxMjUsMjYyNSwzMzc1LDMxMjUsMzc1MCwzMjUwLDM2MjUsMzUwMCwzMzc1LDM3NTAsMzM3NSwzMjUwLDM1MDAsMzUwMCwzMzc1LDMwMDAsNDM3NSwzMTI1LDQxMjUsMzEyNSwzNTAwLDMzNzUsMzc1MCwzNjI1LDMwMDAsMjg3NSwyNzUwLDI4NzUsMzUwMCwzMzc1LDI1MDAsMzc1MCwyNzUwLDI2MjUsMjg3NSwzNjI1LDM3NTAsMzc1MCwyNjI1LDMxMjUsMzUwMCwzMjUwLDMzNzUsNDEyNSwzNzUwLDI4NzUsMzI1MCwzMjUwLDI2MjUsMzYyNSwyMjUwLDI3NTAsMjM3NV0sIm9wcyI6MzE2OH0seyJuYW1lIjoiZm9yZWFjaCIsImNvZGUiOiJsZXQgcmVzID0gW11cbmRhdGEuZm9yRWFjaChhc3luYyB2ID0%2BIHJlcy5wdXNoKGF3YWl0IHYoKSApKVxuXG5jb25zb2xlLmxvZyhyZXMpIiwicnVucyI6WzIwMDAsMjAwMCwxNjI1LDIxMjUsMzI1MCwzMjUwLDMxMjUsMzEyNSwzMjUwLDMyNTAsMzEyNSwzMTI1LDMwMDAsMjM3NSwzMDAwLDMxMjUsMjEyNSwyODc1LDIxMjUsMjM3NSwzMTI1LDMwMDAsMzUwMCwzMjUwLDMxMjUsMzI1MCwzMjUwLDMxMjUsMzM3NSwzMjUwLDMwMDAsMzI1MCwzMTI1LDMyNTAsMzc1MCwxODc1LDMxMjUsMzI1MCwyMjUwLDMxMjUsMzI1MCwzMTI1LDIyNTAsMjAwMCwyMzc1LDIyNTAsMzg3NSwzMDAwLDMzNzUsMzEyNSwzMTI1LDIxMjUsMjYyNSwyNzUwLDE2MjUsMTYyNSwzMjUwLDM2MjUsMjg3NSwzMDAwLDMyNTAsMjM3NSw0MDAwLDM1MDAsMzM3NSwzMTI1LDMyNTAsMzEyNSwzMTI1LDMwMDAsMzEyNSwzMjUwLDMxMjUsMzEyNSwzMTI1LDMwMDAsMjYyNSwzNTAwLDMxMjUsMjUwMCwzMDAwLDMxMjUsMzI1MCwyMDAwLDI4NzUsMjI1MCwzMTI1LDI4NzUsMzEyNSwyMTI1LDI2MjUsMjg3NSw0MDAwLDIzNzUsMzAwMCwzMDAwLDMyNTAsMjg3NSwzMTI1LDMyNTBdLCJvcHMiOjI5MjV9XSwidXBkYXRlZCI6IjIwMjUtMDUtMjBUMjI6MTY6NTUuMzM5WiJ9

const data = [ ...Array( 1000 ).keys() ].map( v => async () => v )

const run = async () => {

	const fn = async ( {
		title, cb,
	}:{
		title : string
		cb    : () => Promise<void>
	} ) => {

		console.log( title )
		console.time( title )
		await cb()
		console.timeEnd( title )

	}

	await fn( {
		title : 'map',
		cb    : async () => {

			const res: number[] = []
			await Promise.all( data.map( async v => res.push( await v() ) ) )
			// console.log( res )

		},
	} )
	await fn( {
		title : 'map.then.promise',
		cb    : async () => {

			const res = data.map( v => v() )

			await Promise.all( res )
			// console.log( res2 )

		},
	} )

	await fn( {
		title : 'map.set',
		cb    : async () => {

			const res: number[] = []
			await Promise.all( Array.from( new Set( data ) ).map( async v => res.push( await v() ) ) )

			// console.log( res )

		},
	} )

	await fn( {
		title : 'map.set.destruct',
		cb    : async () => {

			const res: number[] = []
			await Promise.all( [ ...new Set( data ) ].map( async v => res.push( await v() ) ) )

			// console.log( res )

		},
	} )

}

run()
